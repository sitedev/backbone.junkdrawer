define(function(c,b,d){var a={};(function(n,l){n.Template=function(s,t,r,q){this.r=s||this.r;this.c=r;this.options=q;this.text=t||"";this.buf=(l)?[]:""};n.Template.prototype={r:function(s,r,q){return""},v:g,t:i,render:function f(s,r,q){return this.ri([s],r||{},q)},ri:function(s,r,q){return this.r(s,r,q)},rp:function(s,u,t,q){var r=t[s];if(!r){return""}if(this.c&&typeof r=="string"){r=this.c.compile(r,this.options)}return r.ri(u,t,q)},rs:function(t,s,u){var q=t[t.length-1];if(!k(q)){u(t,s,this);return}for(var r=0;r<q.length;r++){t.push(q[r]);u(t,s,this);t.pop()}},s:function(w,r,u,s,x,q,t){var v;if(k(w)&&w.length===0){return false}if(typeof w=="function"){w=this.ls(w,r,u,s,x,q,t)}v=(w==="")||!!w;if(!s&&v&&r){r.push((typeof w=="object")?w:r[r.length-1])}return v},d:function(u,r,t,v){var w=u.split("."),x=this.f(w[0],r,t,v),q=null;if(u==="."&&k(r[r.length-2])){return r[r.length-1]}for(var s=1;s<w.length;s++){if(x&&typeof x=="object"&&w[s] in x){q=x;x=x[w[s]]}else{x=""}}if(v&&!x){return false}if(!v&&typeof x=="function"){r.push(q);x=this.lv(x,r,t);r.pop()}return x},f:function(u,q,t,w){var y=false,r=null,x=false;for(var s=q.length-1;s>=0;s--){r=q[s];if(r&&typeof r=="object"&&u in r){y=r[u];x=true;break}}if(!x){return(w)?false:""}if(!w&&typeof y=="function"){y=this.lv(y,q,t)}return y},ho:function(w,q,t,v,s){var u=this.c;var r=this.options;r.delimiters=s;var v=w.call(q,v);v=(v==null)?String(v):v.toString();this.b(u.compile(v,r).render(q,t));return false},b:(l)?function(q){this.buf.push(q)}:function(q){this.buf+=q},fl:(l)?function(){var q=this.buf.join("");this.buf=[];return q}:function(){var q=this.buf;this.buf="";return q},ls:function(r,y,w,s,q,u,z){var v=y[y.length-1],x=null;if(!s&&this.c&&r.length>0){return this.ho(r,v,w,this.text.substring(q,u),z)}x=r.call(v);if(typeof x=="function"){if(s){return true}else{if(this.c){return this.ho(x,v,w,this.text.substring(q,u),z)}}}return x},lv:function(u,s,t){var r=s[s.length-1];var q=u.call(r);if(typeof q=="function"){q=i(q.call(r));if(this.c&&~q.indexOf("{\u007B")){return this.c.compile(q,this.options).render(r,t)}}return i(q)}};var m=/&/g,h=/</g,e=/>/g,p=/\'/g,o=/\"/g,j=/[&<>\"\']/;function i(q){return String((q===null||q===undefined)?"":q)}function g(q){q=i(q);return j.test(q)?q.replace(m,"&amp;").replace(h,"&lt;").replace(e,"&gt;").replace(p,"&#39;").replace(o,"&quot;"):q}var k=Array.isArray||function(q){return Object.prototype.toString.call(q)==="[object Array]"}})(typeof b!=="undefined"?b:a);(function(r){var j=/\S/,n=/\"/g,s=/\n/g,o=/\r/g,y=/\\/g,e={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};r.scan=function q(K,F){var S=K.length,C=0,H=1,B=2,D=C,G=null,U=null,T="",N=[],J=false,R=0,O=0,L="{{",Q="}}";function P(){if(T.length>0){N.push(new String(T));T=""}}function E(){var W=true;for(var V=O;V<N.length;V++){W=(N[V].tag&&e[N[V].tag]<e._v)||(!N[V].tag&&N[V].match(j)===null);if(!W){return false}}return W}function M(Y,V){P();if(Y&&E()){for(var W=O,X;W<N.length;W++){if(!N[W].tag){if((X=N[W+1])&&X.tag==">"){X.indent=N[W].toString()}N.splice(W,1)}}}else{if(!V){N.push({tag:"\n"})}}J=false;O=N.length}function I(Z,W){var Y="="+Q,V=Z.indexOf(Y,W),X=u(Z.substring(Z.indexOf("=",W)+1,V)).split(" ");L=X[0];Q=X[1];return V+Y.length-1}if(F){F=F.split(" ");L=F[0];Q=F[1]}for(R=0;R<S;R++){if(D==C){if(A(L,K,R)){--R;P();D=H}else{if(K.charAt(R)=="\n"){M(J)}else{T+=K.charAt(R)}}}else{if(D==H){R+=L.length-1;U=e[K.charAt(R+1)];G=U?K.charAt(R+1):"_v";if(G=="="){R=I(K,R);D=C}else{if(U){R++}D=B}J=R}else{if(A(Q,K,R)){N.push({tag:G,n:u(T),otag:L,ctag:Q,i:(G=="/")?J-Q.length:R+L.length});T="";R+=Q.length-1;D=C;if(G=="{"){if(Q=="}}"){R++}else{v(N[N.length-1])}}}else{T+=K.charAt(R)}}}}M(J,true);return N};function v(B){if(B.n.substr(B.n.length-1)==="}"){B.n=B.n.substring(0,B.n.length-1)}}function u(B){if(B.trim){return B.trim()}return B.replace(/^\s*|\s*$/g,"")}function A(B,F,D){if(F.charAt(D)!=B.charAt(0)){return false}for(var E=1,C=B.length;E<C;E++){if(F.charAt(D+E)!=B.charAt(E)){return false}}return true}function f(H,E,C,G){var B=[],F=null,D=null;while(H.length>0){D=H.shift();if(D.tag=="#"||D.tag=="^"||i(D,G)){C.push(D);D.nodes=f(H,D.tag,C,G);B.push(D)}else{if(D.tag=="/"){if(C.length===0){throw new Error("Closing tag without opener: /"+D.n)}F=C.pop();if(D.n!=F.n&&!k(D.n,F.n,G)){throw new Error("Nesting error: "+F.n+" vs. "+D.n)}F.end=D.i;return B}else{B.push(D)}}}if(C.length>0){throw new Error("missing closing tag: "+C.pop().n)}return B}function i(E,C){for(var D=0,B=C.length;D<B;D++){if(C[D].o==E.n){E.tag="#";return true}}}function k(F,D,C){for(var E=0,B=C.length;E<B;E++){if(C[E].c==F&&C[E].o==D){return true}}}r.generate=function(B,E,C){var D='var _=this;_.b(i=i||"");'+x(B)+"return _.fl();";if(C.asString){return"function(c,p,i){"+D+";}"}return new r.Template(new Function("c","p","i",D),E,r,C)};function z(B){return B.replace(y,"\\\\").replace(n,'\\"').replace(s,"\\n").replace(o,"\\r")}function m(B){return(~B.indexOf("."))?"d":"f"}function x(C){var F="";for(var E=0,D=C.length;E<D;E++){var B=C[E].tag;if(B=="#"){F+=l(C[E].nodes,C[E].n,m(C[E].n),C[E].i,C[E].end,C[E].otag+" "+C[E].ctag)}else{if(B=="^"){F+=w(C[E].nodes,C[E].n,m(C[E].n))}else{if(B=="<"||B==">"){F+=h(C[E])}else{if(B=="{"||B=="&"){F+=g(C[E].n,m(C[E].n))}else{if(B=="\n"){F+=p('"\\n"'+(C.length-1==E?"":" + i"))}else{if(B=="_v"){F+=t(C[E].n,m(C[E].n))}else{if(B===undefined){F+=p('"'+z(C[E])+'"')}}}}}}}}return F}function l(C,G,F,E,B,D){return"if(_.s(_."+F+'("'+z(G)+'",c,p,1),c,p,0,'+E+","+B+',"'+D+'")){_.rs(c,p,function(c,p,_){'+x(C)+"});c.pop();}"}function w(B,D,C){return"if(!_.s(_."+C+'("'+z(D)+'",c,p,1),c,p,1,0,0,"")){'+x(B)+"};"}function h(B){return'_.b(_.rp("'+z(B.n)+'",c,p,"'+(B.indent||"")+'"));'}function g(C,B){return"_.b(_.t(_."+B+'("'+z(C)+'",c,p,0)));'}function t(C,B){return"_.b(_.v(_."+B+'("'+z(C)+'",c,p,0)));'}function p(B){return"_.b("+B+");"}r.parse=function(C,D,B){B=B||{};return f(C,"",[],B.sectionTags||[])},r.cache={};r.compile=function(E,B){B=B||{};var D=E+"||"+!!B.asString;var C=this.cache[D];if(C){return C}C=this.generate(this.parse(this.scan(E,B.delimiters),E,B),E,B);return this.cache[D]=C}})(typeof b!=="undefined"?b:a)});